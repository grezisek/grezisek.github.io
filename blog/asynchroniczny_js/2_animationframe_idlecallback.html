<!DOCTYPE html>
<html lang="pl">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Asynchroniczny js - animationFrame i idleCallback - Grezisek</title>
        <meta name="description" content="developer, blog">
        <link rel="preload" href="https://fonts.googleapis.com/css2?family=Comme:wght@400;700&family=Aleo:wght@400;700&display=swap" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet';this.removeAttribute('as');">
        <link rel="stylesheet" href="/app.css">
        <script src="/app.js"></script>
    </head>
    <body class="site">
        <script>CSSVars();SettingsApply();</script>
        <a href="#content" class="visually-hidden-focusable skip-link">Przeskocz do treści</a>
        
<header class="site__header">
    <a href="/" class="columns columns--layout-1_auto columns--gap-2 branding">
        <svg class="logo" xmlns="http://www.w3.org/2000/svg" width="33" height="41" viewBox="0 0 408 512">
            <g transform="translate(-368 -584)">
                <rect class="logo__neutral" width="80" height="80" transform="translate(696 1016)" fill="#fff"/>
                <path class="logo__neutral" d="M368,1096V584H776V800H696V656H448v360H552v80Z" fill="#fff"/>
                <path class="logo__red" d="M552,1096V880H776v80H632v136Z" fill="red"/>
            </g>
        </svg>grezisek
    </a>

    <a href="/blog/" class="nav-link nav-link--state-current_parent">
        blog
    </a>

    <a href="/projekty/" class="nav-link">
        projekty
    </a>

    <a href="mailto:grezisek@gmail.com">
        e-mail
    </a>
</header>

<article id="content" class="layout site__content">
    <header class="site__content-header">
        <h1>
            Asyn<wbr>chro<wbr>niczny js - animationFrame i idleCallback
        </h1>

        <p>
            Wyjaśniam korzystanie z funkcji animationFrame i idleCallback w asynchronicznym JavaScript.
        </p>
    </header>

    <section>
        <h2>
            Sposób użycia
        </h2>

        <p>
            Funkcjami podobnymi do setTimeout i setInterval są requestAnimationFrame i requestIdleCallback.
            Te nie potrzebują wyznaczania czasu wykonania.
            AnimationFrame dąży do wykonywania instrukcji tak często jak wyświetlacz generuje nowy obraz, czyli zazwyczaj nie częściej, niż 16.667ms (60fps).
            IdleCallback czeka na moment całkowitej bezczynności stosu, czyli wykona się po setTimeout z czasem 0 (bo taki timeout od razu zajmuje bezczynny stos) ale może wykonać się podczas bezczynnego czekania na gotowość timeout (bo czekający timeout nie jest na stosie, tylko w osobnej pamięci).
        </p>

        <pre><code>
requestIdleCallback(() => console.log(4));
console.log(1);
setTimeout(() => console.log(3), 0);
console.log(2);

// 1
// 2
// 3
// 4

requestIdleCallback(() => console.log(3));
console.log(1);
setTimeout(() => console.log(4), 1000);
console.log(2);

// 1
// 2
// 3
// sekunda przerwy
// 4

const timestamp = performance.now();
console.log(1);
requestIdleCallback(() => console.log(5));
setTimeout(() => console.log(3), 0);
setTimeout(() => console.log(4), 500);
setTimeout(() => console.log(6), 1500);
while (timestamp + 1000 > performance.now()) {
    continue;
}
console.log(2);

// 1
// sekunda przerwy
// 2
// 3
// 4
// 5
// pół sekundy przerwy
// 6
        </code></pre>
    </section>

    <section>
        <h2>
            To nie jest asynchroniczny javascript (?)
        </h2>

        <p>
            Zwróć uwagę na ostatni przykład.
            Główny wątek jest zablokowany na sekundę (pętla while),
            3 i 4 przedawniają się przed upływem sekundy i czekają.
            Po sekundzie, 2, 3 i 4 są wrzucone na stos i wykonane, zostawiając pół sekundy przerwy przed ostatnim zadaniem.
            Po wykonaniu 2, 3 i 4 nadal jest zbyt wcześnie na 6 ale stos jest pusty, więc 5 ląduje na stosie i jest wykonane.
            Na koniec mija czas dla 6, które ląduje na stosie i jest wykonane.
        </p>

        <p>
            Zaistniały dwa rodzaje zachowań. Instrukcje blokowały się w głównym wątku z powodu zajętego stosu lub stos bywał pusty a instrukcje wykonywały się na czas.
            Myśląc o asynchronicznym działaniu, mniej-więcej to chcieliśmy osiągnąć - kilka instrukcji może, na różne sposoby, w tym samym czasie czekać na wykonanie.
            Problemem nadal jest fakt, że każda kolejna instrukcja musi czekać na zakończenie poprzedniej.
            Przydałoby się narzędzie, które może podzielić kilka instrukcji na kroki i wykonywać je na zmianę z różną prędkością.
            Główny wątek nie musiałby wykonywać długich instrukcji za jednym zamachem, więc instrukcje wymagające czasu (np. pobieranie plików) mogłyby być także podzielone na kroki i wykonywane na zmianę z instrukcjami głównego wątku.
        </p>
    </section>
    
    <footer class="columns columns--gap-1 site__content-footer">
        <a href="/blog/asynchroniczny_js/">Powrót do listy części</a>
        <a href="/blog/">Powrót do listy artykułów</a>
    </footer>
</article>
        <footer class="site__footer">
<div class="grid grid--layout-1_1_3 grid--gap-2">
    <address>
        <span class="columns columns--layout-auto_1 columns--gap-2 branding branding--state-current">
            <svg class="logo" xmlns="http://www.w3.org/2000/svg" width="33" height="41" viewBox="0 0 408 512">
                <g transform="translate(-368 -584)">
                    <rect class="logo__neutral" width="80" height="80" transform="translate(696 1016)" fill="#fff"/>
                    <path class="logo__neutral" d="M368,1096V584H776V800H696V656H448v360H552v80Z" fill="#fff"/>
                    <path class="logo__red" d="M552,1096V880H776v80H632v136Z" fill="red"/>
                </g>
            </svg>grezisek
        </span>

        <p>Full stack web developer</p>

        <a href="mailto:grezisek@gmail.com">Napisz e-mail</a>
    </address>

    <ul class="accordion">
        <li class="accordion__item">
            <details class="accordion__details">
                <summary class="accordion__summary">
                    Cel tej strony
                </summary>

                <div class="accordion__content">
                    <p>
        Przede wszystkim, chcę dostarczyć czytelnikom wszechstronnego materiału edukacyjnego z zakresu JavaScriptu.
        Strona stawia sobie za zadanie pomóc w nauce tego języka programowania poprzez przystępne tutoriale, praktyczne przykłady i ciekawe projekty.
    </p>

    <p>
        Kolejnym celem jest prezentacja moich własnych projektów.
        Cieszę się, że mogę podzielić się moimi osiągnięciami z szeroką publicznością i pokazać, jak wykorzystuję JavaScript w praktyce.
        Moje projekty są różnorodne i obejmują zarówno drobne funkcje pomocnicze jak i wieloletnie projekty-giganty.
        Pragnę zainspirować innych programistów do eksperymentowania i tworzenia innowacyjnych rozwiązań.
    </p>

    <p>
        Wreszcie, pragnę znaleźć pracę, która pozwoli mi wykorzystać moje doświadczenie w programowaniu i jednocześnie zapewni dynamiczne i kreatywne środowisko pracy.
        Cieszę się, że mogę zaprezentować swoje portfolio i udostępnić informacje o moich osiągnięciach na tej stronie.
        Liczę na to, że przyciągnie to uwagę pracodawców, którzy poszukują zdolnego i zaangażowanego programisty.
    </p>
                </div>
            </details>
        </li>
        <li class="accordion__item">
            <details class="accordion__details">
                <summary class="accordion__summary">
                    Ułatwienia dostępności
                </summary>

                <div class="accordion__content">
                    <p>
        Poprawa dostępności materiałów edukacyjnych jest jednym z głównych priorytetów technologicznych mojej strony internetowej.
        Ta została zaprojektowana i rozwijana zgodnie z wytycznymi WCAG w celu spełnienia co najmniej wersji AA.
        Oznacza to, że dokładam wszelkich starań, aby treści były czytelne, łatwe do nawigacji i dostępne dla osób z różnymi rodzajami niepełnosprawności oraz w trudnych warunkach.
    </p>

    <p>
        Aby zapewnić jak największe dopasowanie, moja strona obsługuje automatyczne przełączanie między jasnym i ciemnym trybem.
        Możesz polegać na ustawieniach swojego urządzenia i oczekiwać przewidywalnych rezultatów (szczególnie braku nagłej, oślepiającej bieli w środku nocy).
        Strona automatycznie wykrywa też twoje preferencje ograniczonej ilości efektów ruchu i zmienia sposób animowania na bardziej przyjazny.
    </p>

    <p>
        Ponadto, moja strona automatycznie redukuje zużycie internetu, wykrywając odpowiedni nagłówek HTTP i dostosowując zawartość.
        Dzięki temu, korzystając z wolniejszego połączenia internetowego lub ograniczonego pakietu danych, możesz nadal korzystać z treści strony w sposób efektywny i bez większych przeszkód.
    </p>

    <p>
        Moja strona umożliwia pełne nawigowanie za pomocą klawiatury.
        Jeśli korzystasz z czytnika ekranowego lub masz trudności w obsłudze myszy, możesz swobodnie poruszać się po stronie i korzystać z jej funkcjonalności.
    </p>

    <p>
        Dodatkowe dostosowanie strony do potrzeb lub upodobań jest możliwe poprzez panel ustawień.
        Możesz tam ręcznie kontrolować kontrast, przełączać między jasnym i ciemnym trybem, regulować grubość obramowań elementów interaktywnych, kontrolować sposób zapisu ustawień i zarządzać zapisanymi danymi.
    </p>

    <p>
        Dążę do ciągłego doskonalenia dostępności mojej strony i monitorowania nowych wytycznych WCAG.
        Jeśli masz jakiekolwiek sugestie lub uwagi dotyczące dostępności mojej strony, proszę o kontakt.
        Cenię opinię użytkowników i jestem otwarty na wprowadzanie ulepszeń, aby zapewnić jak najlepsze doświadczenie dla wszystkich odwiedzających.
    </p>
                </div>
            </details>
        </li>
        <li class="accordion__item">
            <details class="accordion__details">
                <summary class="accordion__summary">
                    Polityka prywatności
                </summary>

                <div class="accordion__content">
                    <ol>
        <li>
            <b>Pliki cookie i śledzenie:</b> Ta strona internetowa nie używa plików cookie ani śledzenia.
            Nie gromadzę żadnych informacji o Twojej wizycie na stronie.
        </li>
        <li>
            <b>Dane przekazywane w mailu:</b> Jeśli skontaktujesz się ze mną, przesyłając wiadomość e-mail, będę przetwarzać jedynie te dane, które dobrowolnie mi udostępnisz w treści wiadomości.
            Te informacje są używane wyłącznie w celu odpowiedzi na Twoje pytania i zgłoszenia lub wcale.
            Są to jednocześnie jedyne informacje o Tobie, do których mam dostęp.
        </li>
        <li>
            <b>Dane ustawień:</b> Strona może używać lokalnej pamięci przeglądarki do zapamiętywania ustawień.
            W odróżnieniu od cookie, te dane nie są wysyłane przez internet.
            Zapamiętywanie ustawień jest opcjonalne i domyślnie nieaktywne.
            Zapisane ustawienia możesz zobaczyć lub usunąć w panelu ustawień strony, w grupie "Zapisane ustawienia" lub z poziomu panelu przeglądarki.
        </li>
        <li>
            <b>Udostępnianie danych:</b> Nie udostępniam żadnych przekazanych mi danych osobom trzecim bez Twojej zgody, chyba że wymaga tego prawo.
        </li>
        <li>
            <b>Bezpieczeństwo:</b> Stosuję odpowiednie środki bezpieczeństwa, aby chronić Twoje dane przed nieuprawnionym dostępem, utratą lub nieuprawnionym ujawnieniem.
            Jednakże, żadna metoda przesyłania danych przez internet nie jest całkowicie bezpieczna i nie mogę zagwarantować absolutnego bezpieczeństwa przekazywanych informacji.
        </li>
        <li>
            <b>Zmiany w polityce prywatności:</b> Niniejsza polityka prywatności może być okresowo aktualizowana.
            Wszelkie istotne zmiany będą opublikowane na tej stronie.
        </li>
    </ol>
                </div>
            </details>
        </li>
    </ul>
    <small>© grezisek 2023. Wszystkie prawa zastrzeżone.</small>
</div>
</footer>

    <div class="settings">
        <button id="settings_open" class="settings__open">Ustawienia</button>
        
        <dialog id="settings_panel" class="settings__panel">
            <div id="settings_panel_content" class="columns settings__panel-content">
                <h2>
                    Ustawienia
                </h2>

                <button id="settings_close" class="settings__panel-close">
                    Zamknij
                </button>

                <form id="settings_form" class="settings__form">
                    <fieldset class="columns columns--gap-1">
                        <legend>Motyw:</legend>

                        <label class="columns columns--layout-auto_1 columns--gap-1">
                            <input type="radio" name="theme" value="">
                            Automatyczny (urządzenie)
                        </label>

                        <label class="columns columns--layout-auto_1 columns--gap-1">
                            <input type="radio" name="theme" value="dark">
                            Ciemny
                        </label>

                        <label class="columns columns--layout-auto_1 columns--gap-1">
                            <input type="radio" name="theme" value="light">
                            Jasny
                        </label>
                    </fieldset>

                    <fieldset class="columns columns--gap-1">
                        <legend>Kontrast:</legend>

                        <label class="columns columns--layout-auto_1 columns--gap-1">
                            <input type="radio" name="contrast" value="">
                            Automatyczny (urządzenie)
                        </label>

                        <label class="columns columns--layout-auto_1 columns--gap-1">
                            <input type="radio" name="contrast" value="less">
                            Normalny
                        </label>

                        <label class="columns columns--layout-auto_1 columns--gap-1">
                            <input type="radio" name="contrast" value="more">
                            Zwiększony
                        </label>
                    </fieldset>

                    <fieldset class="columns columns--gap-1">
                        <legend>Grubość obramówek:</legend>

                        <label class="columns columns--layout-auto_1 columns--gap-1">
                            <input type="radio" name="border_width" value="">
                            Normalne
                        </label>

                        <label class="columns columns--layout-auto_1 columns--gap-1">
                            <input type="radio" name="border_width" value="thin">
                            Cienkie
                        </label>

                        <label class="columns columns--layout-auto_1 columns--gap-1">
                            <input type="radio" name="border_width" value="thick">
                            Grube
                        </label>
                    </fieldset>

                    <fieldset class="columns columns--gap-1">
                        <legend>Zapamiętywanie ustawień:</legend>

                        <label class="columns columns--layout-auto_1 columns--gap-1">
                            <input type="radio" name="data" value="">
                            Brak
                        </label>

                        <label class="columns columns--layout-auto_1 columns--gap-1">
                            <input type="radio" name="data" value="local_storage">
                            Trwały zapis w przeglądarce (localStorage)
                        </label>

                        <label class="columns columns--layout-auto_1 columns--gap-1">
                            <input type="radio" name="data" value="session_storage">
                            Tymczasowy zapis w przeglądarce (sessionStorage)
                        </label>
                    </fieldset>

                    <fieldset class="columns columns--gap-1">
                        <legend>Zapisane ustawienia:</legend>
                        <code id="settings_output" class="background-frame"></code>
                        <button id="settings_delete">Usuń zapisane ustawienia</button>
                    </fieldset>
                </form>
            </div>
        </dialog>
    </div>

<script>(() => {
    if (navigator.connection?.saveData) {
        return;
    }

    let scriptLoaded = false;

    const loadScript = () => {
        if (scriptLoaded) {
            return;
        }

        if (!document.querySelector("pre code")) {
            return;
        }
        
        const scriptNode = document.createElement("script");
        scriptNode.src = "//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js";
        document.documentElement.appendChild(scriptNode);
        
        scriptNode.addEventListener("load", () => hljs.highlightAll());

        scriptLoaded = true;
    }; 

    document.documentElement.addEventListener("viewchange", loadScript);

    loadScript();
})()</script>
    </body>
</html>